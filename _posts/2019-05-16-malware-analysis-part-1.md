---
title: Malware Analysis - Lab Setup (Part 1)
layout: post
---

# Malware Analysis (Part 1)

Merhaba arkadaşlar **Malware Analizi** serimin ilk part'ına hoşgeldiniz.

Bu part içerisinde bir **Malware**'nin **Analiz**'ini yapacağımız **Lab**'ı oluşturacağız.

Teknik konulara ileriki partlarda değineceğiz. Şimdi **Lab**'imizi kurmaya geçelim yavaştan.

**Malware** kelimesine daha önce denk gelmeyen arkadaşlar için **Twitter**'de denk geldiğim bir arkadaşın blog yazısını bırakıyorum buraya :

[Blog yazısı](https://uae-ii.blogspot.com/2019/02/kotu-amacl-yazlm-nam-diger-malware.html)

Bu **Lab** için ben **VMware** kullanacağım **sanal makine** olarak.

Ayrıca ben bir **Portable Executable**'ın analizini yapacağımdan **Win 7** kurdum test makinesi olarak.

![](https://lh3.googleusercontent.com/4M5yk7FG0aqjJ4J4bKqINLmhVSNSc4Wa6_homsWz4fvUi3I-Tt8UH5Jilf79mznnmhw0qg9SPmpW7BYwm_mWtNE7tE7mc8FlnoznkO839qLibLzQvcxT6-GZfyXi1c_rA76xGhmo02K9HMnEk-O_cW7sTL0s1qScc3bhZeFxzSTMTGR7Mjp3lvHCq4bwuL0WpS1xKF9IA5iM5eN5_0dUaV-P3P6J6GcVLTM0LChOiBMy3_sfvl7pjHt8OnvDpt16x1zDkvdj8d0gWlBgk-TvCo77JOnrRK5r-ABguHFxvOKbY-RIO_fbaexVdwc2L8pxbLMC57wpfE5cAbtAu74jNsV2TZcBTHiPDjWfLBkjAgx4LtJN69a73yRrAluWGqLFpaFNV6vSVLmEM2g79UaCiXfPJrhV4dnO32xeHPyEOhwBlSNmQjJiryjXn1xUUV4cB6X1ftFatThgRmVAQtJYnrj1g431tbzFKDuzQtB48hoH8rt0SpWSYvT5OhOWTl4INyzsUIxLUw1DdCp8cPHDGQW5pbCBOU_RQpN9NeF5KedCWpg5eUYwBAfMnfllxfPjBZoZ1IA220zsLGvMUQvzrxMkD5YR-BwF3Y6CL0dfkiRkF6RDfYqAHNRWcRSDr8f6lPV3VkJcdqCt2MzTy86Fmhjttd3luS4=w1836-h973-no)

Bunun dışında birde **Malware**'nin :

* **HTTP**

* **HTTPS**

* **DNS**

* **SMTP**

* **POP3**

* **FTP**

**Protokolleri** gibi ağ üzerinde gerçekleştirdiği **request**'leri dinleyeceğimiz ve **Win 7**'nin **gateway**'i olarak kullanacağımız **Tersine Mühendis**'leri ve **Malware 
Analist**'leri için özel geliştirilmiş **REMnux**'u kullanacağım.

![](https://lh3.googleusercontent.com/21j8a2KmVy27F1GsAXbc_maS8Ignb563w8OPMtMG77Lk2Ox5J621uIVuHwXH7V38NEVslxetT1lG-Vufl7bY4Vt8s7OUdlJZgyRDfnzNNJs-mEOyB9y-DJ35er2aZp-vFNDMOkiLjEZFvfT4Tx792AsBUlVrKaAxNgSGIpavBr-Qr0VWGl39CJ8LRb6-_CpyHxo2TyrDj9ch9Rc9NCJ1taT_3g9ieCY-sdxBzCRIhr2BgM_Hdrv7vPr02DyCW6Q07-NB9ChlVbng4IDDD3ApJXwAzhvmgqgWRB05dc7kOvOo-LOTzw67gZwOPNSGIXOG7qRkQDq0Dzkof6Z_6jCzdfGI-NGo1N6luvFEX6_PwDLB6HzEZ3pI7EbECZ1LNaq47Z75dIdgcordz9c0oiqSKdAbAgSONDYMUrYSTRo6A-EuG14OcfPFw5IHoFf3XE7XOie9-PnhNIoXSMfkoTkFTMFqBFnNb4eQUJxsehNdZMT5rSVVaYSZDFQukkz8-APtI0uJu62F7K8yLpy6qP8HU3C8jAT1cvU-dxegw6GyvDqmmEfXwERwH6ih-IP9k-QNdGpo1i0y39qblWI44vCe9jcEjbpf1cJ5Z4Qzh4uy8h7YJLIwXpjjL7-F_xVFeYpUC2b26bThCwv7ajXiaTWZXqgnsldOgao=w1731-h940-no)

Eğer **işletim sistem**'lerinde tamamsak şayet şimdi **Network Configuration** kısmımıza geçmeden önce biraz **Statik**, **Dinamik**, **Snapshot** ve **Malware** anahtar kelimelerinden bahsedelim.

# Dynamic vs Static Analysis

Örnek veriyorum elimizde bir **Portable Executable** yani çalıştırılabilir bir dosyamız var **Malware** olarak. Bu **Malware**'yi çalıştırmadan ne yaptığını anlamak **Statik Analiz** ile mümkün. Anlatmaya devam etmeden önce **Statik** ve **Dinamik** analizlerinin neler olduklarına bir bakalım.

* **Static Analysis**

	1.  **Malware**'yi çalıştırmadan incelemek

	 2. **Disassemble** edip içerisinde bulunduğu instructionları gözlemlemek

	 3. İçerdiği **Library** ve **Function**'ları görüntülemek

	 4. İçerdiği **String**'leri görüntülemek

	 5. **Obfuscate** edildimi edilmedimi **PEid** gibi bir tool ile test etmek

![](https://uldissprogis.files.wordpress.com/2016/01/static-analysis-dynamic-analysis.jpg?w=640)

* **Dynamic Analysis**
	1. **Malware**'yi çalışırken incelemek
	
	2.  Bir **Debugger** aracılığı ile içerisindeki instructionları gözlemlemek
	
	3.  Bir **Sanal Makine** içerisinde **Snapshot** aldıktan sonra çalıştırıp **Etkisini** gözlemleyip eski **Snapshot**'a geri dönmek
	
	4.  **Malware**'i çalıştırmadan önce **RegShot** gibi bir tool ile **Registry**'nin **Shot**'unu alıp **Malware** çalıştıktan sonraki **Registry** ile karşılaştırmak
	
	5.  **Malware** çalıştıktan sonra **REMnux** gibi bir **İşletim Sistemi** içerisinden **Malware**'nin gerçekleştirdiği **Protocol Request**'lerini gözlemlemek


Tabi bu yukarıda saydıklarımız sadece bir kaçı. İleride bazılarını daha detaylı inceleyeceğimizden şimdilik sadece kafanızda **Dinamik** ve **Statik** analizlerinin neler olduklarına dair bir şema oluşması için yukarıda ekleme yaptım.

**Dinamik Analiz** bize **Malware**'yi anlamamız açısından daha iyi yardımcı olacaktır **Yüzeysel** olarak. 

**Malware** çalıştırdığımız **Sanal Makine** içerisinden asıl makinemize ulaşmaya çalışıyor olması bile muhtemel olabilir. 

Bu yüzden bu **Malware**'yi çalıştırdıktan sonra ne olursa olsun bizim **Ana Makinemize** dokunmayacağından hem **Network** hemde **VM Escape** açısından korunaklı olduğumuzdan emin olmamız lazım.  

Bu açıdan **Ağ**'ımızı asıl makinemize ulaşılamayacak şekilde düzenlememiz yani **Host**'tan **İzole** etmemiz ve **Sanal Makine**'nin bir **Snapshot**'unu almamız gerekiyor.

# Virtual Network and Snapshot

**Snapshot** nedir ? :

* **Makine**'mizin alınmış bir kopyasıdır. **Malware** çalıştıktan sonra **Sanal Makine** içerisinde **Kırılmalar** oluşabilir bu yüzden tekrar eski haline getirmek için bir **Snapshot**'unu almamız gereklidir.

**VMware** içerisinde bulunan **Sanal Makinemiz** için bir **Snapshot** alalım :

![](https://lh3.googleusercontent.com/rBTUrIsb76zq4sEOuAVUGba7rO0dQdOwnRNdlXVxIceYrWaXSK8B_qRsJsSQBHRL48MHM0a-6_ueCJExrHE321gIiZxnhfhlSHyw27HfDWxSXVZFthKIiPrMMpiZaiGQvhyubuus4MqCrI5Jpcdd0iWuKWSnW5wMctwcHfcwC7pFgppiU0NoUcjHLWNkM5_Unmu7hihQPDGJrrFIsKufl4jnAps8DUqOBdHiyp8CGHEorqtz50lOGxSz44XgqSkR9Y2yfZfSOQmm1q1YT2UskhAktTHc541wNOkdpsfwRtgEFJTUzBxZZ5wpgfnFESV7RTTnaQJLxnPF0eBvmO5rSOwOcYIUW4k3fnXEwfyKIgZLlLj4J8FrIXa-cncD-gTQvlyDVsv6i45-tF-Q3yQbkCjASsx2hzbn4IHpvatbgnuYzVHhfRFVM91nt-M3wE6DTrVfqYa4gvvnxSHCK20qMuyKjsIneORgA0nx_MmKYCqhJSrbXNSvHEnv92FwwONu_HteJSBX-0fWLAXGE8omMV6hcC28AL1fc39e6CQ19SgWvs0qbAfS_dZcpajixHleJSqhmyC065NnBsgMkK29gBpxHTQ2zV5e1O3j1vh1hQm2XOuLqCZCOKhQpZ1CXmAeq7nkGjuXg3ZWBNVR_4fZZCZu5A0SYvI=w1797-h973-no)

**Snapshot**'umuzu aldığımıza göre şimdi **Network Configuration** kısmına geçebiliriz.

Bu kısımı görsel ile anlatmak biraz uzun sürebilir bu yüzden hem **REMnux** hemde **Win 7** için **Ağ** ayarlarını yaptığım ve nasıl yapıldığını anlattım.

Ayrıca bir **Malware**'nin **Protocol Request**'lerini canlı olarak nasıl izlendiğini anlattığım videoma alıyım sizleri :

[Network Visulation & Malware Request Track Youtube Vid](https://youtu.be/oCO3xsIktng)


# Video hakkında

Bu videoda kullandığım **inetsim**, **fakedns** gibi toollar bize sahte protocol sunucuları oluşturdu.

Video içerisinde anlattığım **Route Traffic** olayıda basit bir şekilde bilgisayarı ve interneti olan bir kişi **Google**'ye girmek isterse bu trafik **Gateway**'inden geçer ve bu gateway ancak izin verirse istediği yere ulaşabilir **Google**'ye girmek isteyen kişi.

Bizde normal bir **Gateway** kullanmak yerine **Win 7** için **Gateway** olarak **REMnux**'umuzu kullandık.

Dolayısıyla **Win 7** içerisinde geçen tüm **Request**'ler bizim **REMnux**'umuz içerisine yönlendirildi.

Bu şekilde de **Malware**'mizin internet üzerinde yaptığı tüm istekleri izleyebilir hale geldik.

# THE END
**Malware Analysis** serimizin ilk part'ını umarım keyifle okumuşsunuzdur.

İlerideki partlarda **Static** ve **Dynamic** analizlere deyineceğim.

Ve dahada ileriki partlarda dahada teknik detaylara gireceğiz.

Sağlıcakla Kalın !