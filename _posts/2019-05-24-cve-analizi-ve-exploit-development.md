---
title: libSSH(CVE-2018-10933) Zafiyeti, Exploit GeliÅŸtirme ve CVE Ã¼zerine
layout: post
---

# libSSH(CVE-2018-10933) Zafiyeti, Exploit GeliÅŸtirme ve CVE Ã¼zerine

HoÅŸgeldiniz.

Bu yazÄ±mda biraz uzun sÃ¼redir biliÅŸim alanÄ±da bahsedilen **CVE-2018-10933**(libSSH-RCE) zafiyetinden, biraz **Exploit** geliÅŸtirilmesinden ve biraz da **CVE**'lerden bahsedeceÄŸim.

# libSSH Nedir ?

**libSSH** basit bir ÅŸekilde **C** ile yazÄ±lmÄ±ÅŸ bir kÃ¼tÃ¼phanedir ve bu kÃ¼tÃ¼phane **Protocol** olarak ÅŸuanda **SSHv2** protokolÃ¼nÃ¼ kullanmaktadÄ±r.

Sunucular bu kÃ¼tÃ¼phaneyi kullanarak **Client** ve **Server** tarafÄ±nda **SSH** baÄŸlantÄ±larÄ± oluÅŸturmaktadÄ±r.

# zZzZzZzZzZzZzZzZzZzZ

Ã‡ok kÄ±sa bir sÃ¼re Ã¶ncesinde internet Ã¼zerinde **Peter Winter-Smith** tarafÄ±ndan ortaya Ã§Ä±karÄ±lmÄ±ÅŸ bir zafiyettir bu.

Bu zafiyetin iÃ§eriÄŸini basit bir ÅŸekilde anlatacak olursam ÅŸayet :

![](https://resmim.net/f/JUzxiw.jpg)

Basit bir ÅŸekilde **SandviÃ§** istediÄŸimizde **HayÄ±r** deniliyor ÅŸayet **SandviÃ§ Success** dediÄŸimizde ÅŸartsÄ±z bir ÅŸekilde karÅŸÄ±daki hemen yapayÄ±m efendim diyor.

Yani daha da teknik bir ÅŸekilde aÃ§Ä±klarsam bir **Sunucu** iÃ§erisine **KullanÄ±cÄ± AdÄ±** ve **Åifre** vermeden sadece karÅŸÄ±ya **MSG_USERAUTH_SUCCESS**  diyerek girebiliyoruz.

Daha da basit ÅŸekilde **libSSH**'in **0.6** versiyonun sonrasÄ±nÄ± kullanan tÃ¼m **Sunucu**'lara kullanÄ±cÄ± bilgilerini vermeden giriÅŸ yapabiliyorduk.

Ve buda biliÅŸim alanÄ±n da Ã§ok bÃ¼yÃ¼k bir yankÄ± oluÅŸturdu.

# Zafiyetin ortaya Ã§Ä±ktÄ±ÄŸÄ±nÄ± nasÄ±l bulup sÃ¶mÃ¼rÃ¼ kodunu geliÅŸtirdim ?

Bu **zafiyet**'i her saniye yenilenen **CVE** listesini incelerken aniden gÃ¶rdÃ¼m.

[libSSH CVE](https://nvd.nist.gov/vuln/detail/CVE-2018-10933)

Ve **libSSH**'te bulunan zafiyetin ne olduÄŸuna dair bir aÃ§Ä±klama bulunduÄŸundan hemen onu okumaya koyuldum.

AÃ§Ä±klama : 

**A vulnerability was found in libssh's server-side state machine before versions 0.7.6 and 0.8.4. A malicious client could create channels without first performing authentication, resulting in unauthorized access.**

Ve hÄ±zlÄ± bir ÅŸekilde **libSSH** kÃ¼tÃ¼phanesinin kodlarÄ±nÄ± incelemeye baÅŸladÄ±m.

Bu kodlar iÃ§inde ÅŸu kÄ±sÄ±m Ã§ok ilgimi Ã§ekti :

![](https://resmim.net/f/zfy1mC.png)

Ã‡Ã¼nkÃ¼ bu kÄ±sÄ±mda geÃ§en diyalog basit bir ÅŸekilde ÅŸÃ¶yle :

EÄŸer oturum iÃ§erisinde **SSH_AUTH_STATE_SUCCESS**  mevcut ise **KullanÄ±cÄ± AdÄ±** ve **Åifre** istemeden giriÅŸi gerÃ§ekleÅŸtir.

Bende bunu anladÄ±ktan sonra bir **Exploit** geliÅŸtirdim. KarÅŸÄ±da **libSSH** kullanan **Sunucu**'da **Komut** Ã§alÄ±ÅŸtÄ±rmayÄ± basitleÅŸtirmek iÃ§in.

Bu yazdÄ±ÄŸÄ±m **Exploit** twitterde Ã§oÄŸu yerde paylaÅŸÄ±ldÄ± ve **Github** iÃ§erisinde baya bir **Star** aldÄ±.

**Github**'ta paylaÅŸtÄ±ÄŸÄ±m bu **Exploit**'in linki : [libSSH Exploit Github](https://github.com/blacknbunny/libSSH-Authentication-Bypass)

Hatta twitterde **16 yaÅŸÄ±ndaki dayanÃ§ soyadlÄ±'nÄ±n libSSH iÃ§in geliÅŸtirdiÄŸi exploit** diye paylaÅŸan arkadaÅŸlar gÃ¶rdÃ¼m bu da beni sevindirdi :

![](https://resmim.net/f/5G8VJu.png)

**Exploit**'i yazdÄ±ktan sonra **Shodan** iÃ§erisinden baktÄ±ÄŸÄ±mda twitterde ne kadar **6500** tane potansiyel olarak hacklenmiÅŸ sistem olduÄŸunu gÃ¶rsemde **Shodan**'da bu sayÄ± **50,000**'i geÃ§miÅŸti.

SevdiÄŸim bir kanal olan **Liveoverflow** sahibiyle konuÅŸurken **libSSH** hakkÄ±nda video Ã§ekecekmisin sorusunu sorduÄŸumda o kadar fazla yerde o kadar farklÄ± ÅŸekilde anlatÄ±lmÄ±ÅŸ ki bana gerek kalmadÄ± dedi ğŸ˜‚ :

![](https://resmim.net/f/Du3nof.png)

YazdÄ±ÄŸÄ±m **exploit** bir Ã§ok **CVE** listesinde yayÄ±mlanmÄ±ÅŸ bulunmaktadÄ±r :

![](https://resmim.net/f/Hzoku8.png)

AynÄ± zamanda **Exploti-DB** iÃ§erisinde de yayÄ±nlandÄ± : [libSSH Exploit](https://www.exploit-db.com/exploits/45638)

Åimdi gelelim bir **CVE**'nin ne olduÄŸuna bunun nasÄ±l analizinin yapÄ±lacaÄŸÄ±na ve bunun iÃ§in **Exploit**'in nasÄ±l geliÅŸtirileceÄŸine.


# CVE Nedir

**CVE** bilgi gÃ¼venliÄŸi zafiyetlerinin bir listesidir.

Daha basit bir ÅŸekilde bir **Zafiyet**'in aÃ§Ä±klandÄ±ÄŸÄ± ve var ise ÅŸayet **Exploit**'lerinin bulunduÄŸu bir kayÄ±ttÄ±r.

Bir kaÃ§ tane **CVE** paylaÅŸÄ±m sitesi :

[CVE Mitre](https://cve.mitre.org/cve/)

[CVE NVD](https://nvd.nist.gov/)

[CVE details](https://www.cvedetails.com/bugtraq-list/)

# CVE Analizi

Ã–ncelikle bir **CVE** bulalÄ±m.

Ben **libSSH**'den baÅŸladÄ±ÄŸÄ±m iÃ§in aynÄ± ÅŸekilde devam edeceÄŸim.

![](https://resmim.net/f/90kjVo.png)

Bu **CVE** listesi iÃ§erisinde benim **Exploit**'ini yazdÄ±ÄŸÄ±m **CVE**'nin **ID**'si **CVE-2018-10933** basit bir ÅŸekilde daha bu **CVE**'nin iÃ§erisine girmeden bu **Zafiyet**'in ne olduÄŸu aÃ§Ä±klanÄ±yor.

Bu **CVE** kaydÄ±na girip benimle ilerlemek isteyenler iÃ§in link : [CVE-2018-10933](https://www.cvedetails.com/cve/CVE-2018-10933/)

Åimdi bu **CVE**'nin iÃ§erisine girdikten sonra iÃ§erisinde **CVE**'nin **CVSS Score**'unu gÃ¶rebiliriz yani ne kadar **Kritik** olduÄŸunu.

![](https://resmim.net/f/R9izHT.png)

AynÄ± zamanda bu **Zafiyet**'ten etkilenen **Product**'larÄ±da gÃ¶rebiliyoruz : 

![](https://resmim.net/f/7SUpDm.png)

Bu **Zafiyet** iÃ§in bulunan **Referans**'larÄ±da gÃ¶rebiliyoruz ayrÄ±ca.

Bu **Referans**'lar iÃ§erisinde **Zafiyet**'in yazÄ±lmÄ±ÅŸ ise **Exploit**'ide bulunur.

![](https://resmim.net/f/g6sR9C.png)

Burada bulunan **Exploit-DB** linki benim size baÅŸta bahsettiÄŸim kendi yazdÄ±ÄŸÄ±m **Exploit**'tir.

Åimdi bu **Exploit**'i nasÄ±l geliÅŸtirdiÄŸime yani bir **CVE**'nin **Analiz**'i sonrasÄ± o **CVE** iÃ§in **Exploit**'in nasÄ±l geliÅŸtirileceÄŸinden bahsedeceÄŸim.


# Exploit Development

Daha derine inmeden Ã¶nce size basit bir ÅŸekilde bir **Exploit**'in ne olduÄŸundan ve nasÄ±l geliÅŸtirilebileceÄŸinden bahsetmek istiyorum.

#### Exploit nedir ?

Bir **Exploit** genellikle **Zafiyet** iÃ§eren bir kodu sÃ¶mÃ¼rmek iÃ§in geliÅŸtirilen bir kod parÃ§asÄ±dÄ±r.

#### Exploit Development Nedir ?

**Zafiyet** iÃ§erilen kodu **Analiz** ettikten sonra bu kodu sÃ¶mÃ¼rge iÃ§in kullanÄ±lacak kodu geliÅŸtirmektir.

Daha da aÃ§arsam konuyu **Exploit** geliÅŸtirmek iÃ§in bu sÃ¶mÃ¼rge kod parÃ§asÄ±nÄ± yazacaÄŸÄ±nÄ±z **Zafiyeti** ve bu **Zafiyet**'in **Kod**'unu kavramanÄ±z gerekmektedir.

#### libSSH zafiyetinin sÃ¶mÃ¼rÃ¼ kodunu nasÄ±l geliÅŸtirdim ? (biraz daha teknik)

DediÄŸim gibi **CVE** listelerinde gezerken denk geldim ve **libSSH** bir kÃ¼tÃ¼phane olduÄŸundan **Authentication** yapÄ±lan kÄ±sÄ±mlarÄ± incelemeye baÅŸladÄ±m bu kÃ¼tÃ¼phane iÃ§erisinde.

Yani gerÃ§ekleÅŸtirilecek oturum yani **Session** iÃ§in kÃ¼tÃ¼phane iÃ§erisinde var olan **GiriÅŸ**, **Ã‡Ä±kÄ±ÅŸ** ve **Kontrol** kodlarÄ±nÄ± incelemeye baÅŸladÄ±m.

Ve bu kodlar iÃ§erisinde baÅŸtada resmini verdiÄŸim **Kaynak Kod**'una denk geldim.

**libSSH** iÃ§erisinde bulunan ÅŸu kÃ¼Ã§Ã¼k **Kod ParÃ§a**'sÄ± benim gerekli olan **Exploit**'i geliÅŸtirmemi saÄŸladÄ± diyebilirim :

```
SSH_PACKET_CALLBACK(ssh_packet_userauth_success)
  (void)packet;
  (void)type;
  (void)user;

  SSH_LOG(SSH_LOG_DEBUG, "Authentication successful");
  SSH_LOG(SSH_LOG_TRACE, "Received SSH_USERAUTH_SUCCESS");

  session->auth.state = SSH_AUTH_STATE_SUCCESS;
```

Burada gÃ¶rdÃ¼ÄŸÃ¼nÃ¼z **Kaynak Kod** basit bir ÅŸekilde eÄŸer dÄ±ÅŸarÄ±dan **libSSH** Ã§alÄ±ÅŸtÄ±rÄ±lan sunucu iÃ§erisinde **SSH_AUTH_STATE_SUCCESS** byte'Ä± eklenirse aÅŸÅŸaÄŸÄ±daki kodu Ã§alÄ±ÅŸtÄ±r diyor :

```
session-> auth.state = SSH_AUTH_STATE_SUCCESS;
```

Ve bu **Kod** ise basit bir ÅŸekilde **session** iÃ§erisinde bulunan **auth** objesindeki **state** deÄŸiÅŸkenine **SSH_AUTH_STATE_SUCCESS** byte'Ä±nÄ± ekliyor.

Buda demek ki sunucuya gÃ¶nderdiÄŸimiz **SSH_AUTH_STATE_SUCCESS** byte'Ä± bizi sunucu'ya **KullanÄ±cÄ± AdÄ±** ve **Åifre** vermeden sokabilecek.

Bende **CVE**'de ki aÃ§Ä±klamayÄ± okuduktan sonra **libSSH** iÃ§erisindeki **Kaynak Kod**'larÄ± inceledikten sonra **Exploit**'i geliÅŸtirmek iÃ§in **Zafiyet**'i bu ÅŸekilde kavradÄ±m.

Ve sÃ¶mÃ¼rge kodunu geliÅŸtirdim.

Åimdi daha da derine inip sizlerin nasÄ±l **Exploit** geliÅŸtirebileceÄŸinden bahsedeyim.
# Exploit Development

Ã–ncelikle **Kaynak Kod** okumaya aÅŸina olmanÄ±z gerek.

Ã‡ok Ã§ok Ã¶nceden var olan bir sÃ¶z vardÄ±r.

**Bir hacker programcÄ±dan daha iyi programlaya bildiÄŸi ve bunu tersine kullana bildiÄŸi iÃ§in hackerdir.**

Yani basit bir ÅŸekilde sizlerin **SÃ¶mÃ¼rge Kod**'unu geliÅŸtirmeniz iÃ§in **Kaynak Kod**'u okumaya aÅŸina olmanÄ±z gerek.

Kendi **Exploit**'lerinizi geliÅŸtirmek iÃ§in **Zafiyet**'i illaki sizin bulmanÄ±z gerekmez.

YalnÄ±z bir hedef'e **SaldÄ±rmadan** Ã¶nce o hedefi **TanÄ±manÄ±z** gereklidir.

Bir Ã§ok

* FTP
* SMTP
* SSH
* HTTP
* vs...

**Exploit** kodu gÃ¶rebiliyorum internet'te yalnÄ±z bu **Exploit** geliÅŸtirenlerin 0'dan bir **FTP** ya da **SMTP** vs... **Server**'i ya da **Client**'i geliÅŸtirebileni **%5**'lik hisse.

DolayÄ±sÄ± ile **Zafiyet**'i tanÄ±mak ve buna gerekli **Exploit**'i geliÅŸtirebilmeniz iÃ§in **Teknoloji**'yi kendiniz yazmÄ±ÅŸ gibi tanÄ±manÄ±z gerekmekte.

# THE END
Bu yazÄ±mÄ±zÄ±nda sonuna geldik.

Bir **CVE**'nin ne olduÄŸundan ve bunun **Analizi**'nin nasÄ±l yapÄ±lacaÄŸÄ±ndan aynÄ± zamanda **Zafiyet**'ler iÃ§in nasÄ±l **SÃ¶mÃ¼rge Kodu** yani **Exploit** geliÅŸtirilebileceÄŸinden bahsettim.

SorularÄ±nÄ±z mevcut ise : [Twitter](https://twitter.com/0DAYanc)
